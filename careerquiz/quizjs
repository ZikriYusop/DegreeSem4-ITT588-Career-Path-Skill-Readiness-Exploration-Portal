/* =========================================
   BAHAGIAN 1: THEME / DARK MODE (Dari Home)
   ========================================= */
document.addEventListener('DOMContentLoaded', () => {
    
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const htmlElement = document.documentElement;

    // Load saved theme
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
        htmlElement.setAttribute('data-bs-theme', savedTheme);
        updateIcon(savedTheme);
    }

    // Toggle event
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            const currentTheme = htmlElement.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            htmlElement.setAttribute('data-bs-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateIcon(newTheme);
        });
    }

    function updateIcon(theme) {
        if (!themeIcon) return;
        if (theme === 'dark') {
            themeIcon.classList.remove('bi-moon-stars-fill');
            themeIcon.classList.add('bi-sun-fill');
        } else {
            themeIcon.classList.remove('bi-sun-fill');
            themeIcon.classList.add('bi-moon-stars-fill');
        }
    }
});

/* =========================================
   BAHAGIAN 2: QUIZ LOGIC (Asal)
   ========================================= */

const questions = document.querySelectorAll(".question");
const progressBar = document.getElementById("progressBar");
const nextBtn = document.getElementById("nextBtn");
const quizForm = document.getElementById("quizForm");
const resultSection = document.getElementById("result-section");
const resultDisplay = document.getElementById("result-display");

let current = 0;
const scores = {
    tech: 0,
    people: 0,
    creative: 0,
    business: 0
};

// Data Asal
const careerMap = {
    tech: "Technology / IT",
    people: "Education / Healthcare / HR",
    creative: "Creative Industry",
    business: "Business / Management"
};

const careerDescription = {
    tech: "Careers focused on problem-solving, technology, and analytical thinking. You excel in environments that require logical thinking and technical expertise.",
    people: "Careers involving communication, helping others, and teamwork. You thrive in roles where you can support and collaborate with people.",
    creative: "Careers that emphasize creativity, design, and innovation. You shine in fields that allow artistic expression and original thinking.",
    business: "Careers related to management, leadership, and organization. You are suited for roles that require strategic planning and decision-making."
};

const careerSkills = {
    tech: ["Problem-solving", "Logical thinking", "Technical skills", "Analytical abilities", "Attention to detail"],
    people: ["Communication", "Empathy", "Teamwork", "Patience", "Interpersonal skills"],
    creative: ["Creativity", "Design thinking", "Innovation", "Visual thinking", "Adaptability"],
    business: ["Leadership", "Planning", "Decision-making", "Strategic thinking", "Organization"]
};

// Event Listener untuk Radio Buttons
document.addEventListener("change", (e) => {
    // Pastikan event berlaku dalam form quiz sahaja
    if (e.target.type === "radio" && e.target.closest("#quizForm")) {
        nextBtn.disabled = false;
    }
});

function showQuestion(index) {
    if (!questions.length) return;

    // Hide all
    questions.forEach(q => q.classList.remove("active"));
    
    // Show current
    questions[index].classList.add("active");
    
    // Update progress bar
    const progressPercentage = ((index + 1) / questions.length) * 100;
    if (progressBar) progressBar.style.width = `${progressPercentage}%`;
    
    // Update button text
    if (index === questions.length - 1) {
        nextBtn.innerHTML = 'See Results <i class="bi bi-check-circle"></i>';
    } else {
        nextBtn.innerHTML = 'Next <i class="bi bi-arrow-right"></i>';
    }
    
    // Check if current question has an answer (untuk enable button Back)
    const isChecked = questions[index].querySelector('input[type="radio"]:checked');
    nextBtn.disabled = !isChecked;
    
    current = index;
}

function nextQuestion() {
    if (current < questions.length - 1) {
        current++;
        showQuestion(current);
    } else {
        calculateResult();
    }
}

function prevQuestion() {
    if (current > 0) {
        current--;
        showQuestion(current);
    }
}

function calculateResult() {
    const checkedAnswers = document.querySelectorAll("input[type=radio]:checked");
    
    // Reset scores
    Object.keys(scores).forEach(key => scores[key] = 0);
    
    // Calculate scores
    checkedAnswers.forEach(ans => {
        if (ans.value in scores) {
            scores[ans.value]++;
        }
    });
    
    // Find best match
    let best = "";
    let max = 0;
    let ties = [];
    
    for (let key in scores) {
        if (scores[key] > max) {
            max = scores[key];
            best = key;
            ties = [key];
        } else if (scores[key] === max) {
            ties.push(key);
        }
    }
    
    if (ties.length > 1) {
        best = ties[0]; 
    }
    
    // Fallback logic
    if (best === "") best = "tech";

    // Show Results
    quizForm.style.display = "none";
    resultSection.style.display = "block";
    
    // Display Results
    resultDisplay.textContent = `Recommended Career Path: ${careerMap[best]}`;
    document.getElementById("print-career").textContent = careerMap[best];
    document.getElementById("career-description").textContent = careerDescription[best];
    
    // Display Skills
    const skillList = document.getElementById("skill-list");
    skillList.innerHTML = "";
    careerSkills[best].forEach(skill => {
        const li = document.createElement("li");
        li.textContent = skill;
        skillList.appendChild(li);
    });
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function submitFeedback() {
    const feedbackText = document.getElementById("feedbackText").value;
    if (feedbackText.trim() === "") {
        alert("Please enter your feedback before submitting.");
        return;
    }
    alert("Thank you for your feedback!");
    document.getElementById("feedbackText").value = "";
}

// Initialize Quiz
if (questions.length > 0) {
    showQuestion(0);
}
